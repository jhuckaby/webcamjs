(function(n){function t(){var n=Error.apply(this,arguments);n.name=this.name="FlashError";this.stack=n.stack;this.message=n.message}function r(){var n=Error.apply(this,arguments);n.name=this.name="WebcamError";this.stack=n.stack;this.message=n.message}var u,i;IntermediateInheritor=function(){};IntermediateInheritor.prototype=Error.prototype;t.prototype=new IntermediateInheritor;r.prototype=new IntermediateInheritor;i={version:"1.0.12",protocol:location.protocol.match(/https/i)?"https":"http",loaded:!1,live:!1,userMedia:!0,params:{width:0,height:0,dest_width:0,dest_height:0,image_format:"jpeg",jpeg_quality:90,force_flash:!1,flip_horiz:!1,fps:30,upload_name:"webcam",constraints:null,swfURL:"",flashNotDetectedText:"ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).",unfreeze_snap:!0,swfEnabled:!0},errors:{FlashError:t,WebcamError:r},hooks:{},init:function(){var t=this;this.mediaDevices=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices:navigator.mozGetUserMedia||navigator.webkitGetUserMedia?{getUserMedia:function(n){return new Promise(function(t,i){(navigator.mozGetUserMedia||navigator.webkitGetUserMedia).call(navigator,n,t,i)})}}:null;n.URL=n.URL||n.webkitURL||n.mozURL||n.msURL;this.userMedia=this.userMedia&&!!this.mediaDevices&&!!n.URL;navigator.userAgent.match(/Firefox\D+(\d+)/)&&parseInt(RegExp.$1,10)<21&&(this.userMedia=null);this.userMedia&&n.addEventListener("beforeunload",function(){t.reset()})},attach:function(t){var h,o,s,f,e,c,l,a;if(typeof t=="string"&&(t=document.getElementById(t)||document.querySelector(t)),!t)return this.dispatch("error",new r("Could not locate DOM element to attach to."));if(this.container=t,t.innerHTML="",h=document.createElement("div"),t.appendChild(h),this.peg=h,this.params.width||(this.params.width=t.offsetWidth),this.params.height||(this.params.height=t.offsetHeight),!this.params.width||!this.params.height)return this.dispatch("error",new r("No width and/or height for webcam.  Please call set() first, or attach to a visible element."));this.params.dest_width||(this.params.dest_width=this.params.width);this.params.dest_height||(this.params.dest_height=this.params.height);this.userMedia=u===undefined?this.userMedia:u;this.params.force_flash&&(u=this.userMedia,this.userMedia=null);typeof this.params.fps!="number"&&(this.params.fps=30);o=this.params.width/this.params.dest_width;s=this.params.height/this.params.dest_height;this.userMedia?(f=document.createElement("video"),f.setAttribute("autoplay","autoplay"),f.style.width=""+this.params.dest_width+"px",f.style.height=""+this.params.dest_height+"px",(o!=1||s!=1)&&(t.style.overflow="hidden",f.style.webkitTransformOrigin="0px 0px",f.style.mozTransformOrigin="0px 0px",f.style.msTransformOrigin="0px 0px",f.style.oTransformOrigin="0px 0px",f.style.transformOrigin="0px 0px",f.style.webkitTransform="scaleX("+o+") scaleY("+s+")",f.style.mozTransform="scaleX("+o+") scaleY("+s+")",f.style.msTransform="scaleX("+o+") scaleY("+s+")",f.style.oTransform="scaleX("+o+") scaleY("+s+")",f.style.transform="scaleX("+o+") scaleY("+s+")"),t.appendChild(f),this.video=f,e=this,this.mediaDevices.getUserMedia({audio:!1,video:this.params.constraints||{mandatory:{minWidth:this.params.dest_width,minHeight:this.params.dest_height}}}).then(function(t){f.onloadedmetadata=function(){e.stream=t;e.loaded=!0;e.live=!0;e.dispatch("load");e.dispatch("live");e.flip()};f.src=n.URL.createObjectURL(t)||t}).catch(function(n){e.detectFlash()?setTimeout(function(){e.params.force_flash=1;e.attach(t)},1):e.dispatch("error",n)})):this.params.swfEnabled&&(n.Webcam=i,c=document.createElement("div"),c.innerHTML=this.getSWFHTML(),t.appendChild(c));this.params.crop_width&&this.params.crop_height?(l=Math.floor(this.params.crop_width*o),a=Math.floor(this.params.crop_height*s),t.style.width=""+l+"px",t.style.height=""+a+"px",t.style.overflow="hidden",t.scrollLeft=Math.floor(this.params.width/2-l/2),t.scrollTop=Math.floor(this.params.height/2-a/2)):(t.style.width=""+this.params.width+"px",t.style.height=""+this.params.height+"px")},reset:function(){if(this.preview_active&&this.unfreeze(),this.unflip(),this.userMedia){if(this.stream)if(this.stream.getVideoTracks){var n=this.stream.getVideoTracks();n&&n[0]&&n[0].stop&&n[0].stop()}else this.stream.stop&&this.stream.stop();delete this.stream;delete this.video}this.userMedia!==!0&&this.getMovie()._releaseCamera();this.container&&(this.container.innerHTML="",delete this.container);this.loaded=!1;this.live=!1},set:function(){if(arguments.length==1)for(var n in arguments[0])this.params[n]=arguments[0][n];else this.params[arguments[0]]=arguments[1]},on:function(n,t){n=n.replace(/^on/i,"").toLowerCase();this.hooks[n]||(this.hooks[n]=[]);this.hooks[n].push(t)},off:function(n,t){if(n=n.replace(/^on/i,"").toLowerCase(),this.hooks[n])if(t){var i=this.hooks[n].indexOf(t);i>-1&&this.hooks[n].splice(i,1)}else this.hooks[n]=[]},dispatch:function(){var f=arguments[0].replace(/^on/i,"").toLowerCase(),u=Array.prototype.slice.call(arguments,1),e,o,i;if(this.hooks[f]&&this.hooks[f].length){for(e=0,o=this.hooks[f].length;e<o;e++)i=this.hooks[f][e],typeof i=="function"?i.apply(this,u):typeof i=="object"&&i.length==2?i[0][i[1]].apply(i[0],u):n[i]&&n[i].apply(n,u);return!0}return f=="error"&&(message=u[0]instanceof t||u[0]instanceof r?u[0].message:"Could not access webcam: "+u[0].name+": "+u[0].message+" "+u[0].toString(),alert("Webcam.js Error: "+message)),!1},setSWFLocation:function(n){this.set("swfURL",n)},detectFlash:function(){var e,r,o;if(!this.params.swfEnabled)return!1;var u="Shockwave Flash",f="application/x-shockwave-flash",s=n,t=navigator,i=!1;if(typeof t.plugins!="undefined"&&typeof t.plugins[u]=="object")e=t.plugins[u].description,e&&typeof t.mimeTypes!="undefined"&&t.mimeTypes[f]&&t.mimeTypes[f].enabledPlugin&&(i=!0);else if(typeof s.ActiveXObject!="undefined")try{r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");r&&(o=r.GetVariable("$version"),o&&(i=!0))}catch(h){}return i},getSWFHTML:function(){var c="",u=this.params.swfURL,f,o,r,s,e,i,h;if(!this.params.swfEnabled)return c;if(location.protocol.match(/file/))return this.dispatch("error",new t("Flash does not work from local disk.  Please run from a web server.")),'<h3 style="color:red">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.<\/h3>';if(!this.detectFlash())return this.dispatch("error",new t("Adobe Flash Player not found.  Please install from get.adobe.com/flashplayer and try again.")),'<h3 style="color:red">'+this.params.flashNotDetectedText+"<\/h3>";if(!u){for(f="",o=document.getElementsByTagName("script"),r=0,s=o.length;r<s;r++)e=o[r].getAttribute("src"),e&&e.match(/\/webcam(\.min)?\.js/)&&(f=e.replace(/\/webcam(\.min)?\.js.*$/,""),r=s);u=f?f+"/webcam.swf":"webcam.swf"}n.localStorage&&!localStorage.getItem("visited")&&(this.params.new_user=1,localStorage.setItem("visited",1));i="";for(h in this.params)i&&(i+="&"),i+=h+"="+escape(this.params[h]);return c+('<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" type="application/x-shockwave-flash" codebase="'+this.protocol+'://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this.params.width+'" height="'+this.params.height+'" id="webcam_movie_obj" align="middle"><param name="wmode" value="opaque" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+u+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+i+'"/><embed id="webcam_movie_embed" src="'+u+'" wmode="opaque" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+this.params.width+'" height="'+this.params.height+'" name="webcam_movie_embed" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'"><\/embed><\/object>')},getMovie:function(){if(!this.loaded)return this.dispatch("error",new t("Flash Movie is not loaded yet"));var n=document.getElementById("webcam_movie_obj");return n&&n._snap||(n=document.getElementById("webcam_movie_embed")),n||this.dispatch("error",new t("Cannot locate Flash movie in DOM")),n},freeze:function(){var r=this,u=this.params,t,i,f;this.preview_active&&this.unfreeze();t=this.params.width/this.params.dest_width;i=this.params.height/this.params.dest_height;this.unflip();var e=u.crop_width||u.dest_width,o=u.crop_height||u.dest_height,n=document.createElement("canvas");n.width=e;n.height=o;f=n.getContext("2d");this.preview_canvas=n;this.preview_context=f;(t!=1||i!=1)&&(n.style.webkitTransformOrigin="0px 0px",n.style.mozTransformOrigin="0px 0px",n.style.msTransformOrigin="0px 0px",n.style.oTransformOrigin="0px 0px",n.style.transformOrigin="0px 0px",n.style.webkitTransform="scaleX("+t+") scaleY("+i+")",n.style.mozTransform="scaleX("+t+") scaleY("+i+")",n.style.msTransform="scaleX("+t+") scaleY("+i+")",n.style.oTransform="scaleX("+t+") scaleY("+i+")",n.style.transform="scaleX("+t+") scaleY("+i+")");this.snap(function(){n.style.position="relative";n.style.left=""+r.container.scrollLeft+"px";n.style.top=""+r.container.scrollTop+"px";r.container.insertBefore(n,r.peg);r.container.style.overflow="hidden";r.preview_active=!0},n)},unfreeze:function(){this.preview_active&&(this.container.removeChild(this.preview_canvas),delete this.preview_context,delete this.preview_canvas,this.preview_active=!1,this.flip())},flip:function(){if(this.params.flip_horiz){var n=this.container.style;n.webkitTransform="scaleX(-1)";n.mozTransform="scaleX(-1)";n.msTransform="scaleX(-1)";n.oTransform="scaleX(-1)";n.transform="scaleX(-1)";n.filter="FlipH";n.msFilter="FlipH"}},unflip:function(){if(this.params.flip_horiz){var n=this.container.style;n.webkitTransform="scaleX(1)";n.mozTransform="scaleX(1)";n.msTransform="scaleX(1)";n.oTransform="scaleX(1)";n.transform="scaleX(1)";n.filter="";n.msFilter=""}},savePreview:function(n,t){var r=this.params,i=this.preview_canvas,f=this.preview_context,u;t&&(u=t.getContext("2d"),u.drawImage(i,0,0));n(t?null:i.toDataURL("image/"+r.image_format,r.jpeg_quality/100),i,f);this.params.unfreeze_snap&&this.unfreeze()},snap:function(n,t){var h=this,i=this.params,u,f,e,s,o;return this.loaded?n?this.preview_active?(this.savePreview(n,t),null):(u=document.createElement("canvas"),u.width=this.params.dest_width,u.height=this.params.dest_height,f=u.getContext("2d"),this.params.flip_horiz&&(f.translate(i.dest_width,0),f.scale(-1,1)),e=function(){var r,e,o;this.src&&this.width&&this.height&&f.drawImage(this,0,0,i.dest_width,i.dest_height);i.crop_width&&i.crop_height&&(r=document.createElement("canvas"),r.width=i.crop_width,r.height=i.crop_height,e=r.getContext("2d"),e.drawImage(u,Math.floor(i.dest_width/2-i.crop_width/2),Math.floor(i.dest_height/2-i.crop_height/2),i.crop_width,i.crop_height,0,0,i.crop_width,i.crop_height),f=e,u=r);t&&(o=t.getContext("2d"),o.drawImage(u,0,0));n(t?null:u.toDataURL("image/"+i.image_format,i.jpeg_quality/100),u,f)},this.userMedia?(f.drawImage(this.video,0,0,this.params.dest_width,this.params.dest_height),e()):(s=this.getMovie()._snap(),o=new Image,o.onload=e,o.src="data:image/"+this.params.image_format+";base64,"+s),null):this.dispatch("error",new r("Please provide a callback function or canvas to snap()")):this.dispatch("error",new r("Webcam is not loaded yet"))},configure:function(n){n||(n="camera");this.getMovie()._configure(n)},flashNotify:function(n,i){switch(n){case"flashLoadComplete":this.loaded=!0;this.dispatch("load");break;case"cameraLive":this.live=!0;this.dispatch("live");break;case"error":this.dispatch("error",new t(i))}},b64ToUint6:function(n){return n>64&&n<91?n-65:n>96&&n<123?n-71:n>47&&n<58?n+4:n===43?62:n===47?63:0},base64DecToArr:function(n,t){for(var s=n.replace(/[^A-Za-z0-9\+\/]/g,""),r=s.length,h=t?Math.ceil((r*3+1>>2)/t)*t:r*3+1>>2,c=new Uint8Array(h),u,f,e=0,o=0,i=0;i<r;i++)if(f=i&3,e|=this.b64ToUint6(s.charCodeAt(i))<<18-6*f,f===3||r-i==1){for(u=0;u<3&&o<h;u++,o++)c[o]=e>>>(16>>>u&24)&255;e=0}return c},upload:function(n,t,r){var o=this.params.upload_name||"webcam",f="",s,u,h,c,e;if(n.match(/^data\:image\/(\w+)/))f=RegExp.$1;else throw"Cannot locate image format in Data URI";s=n.replace(/^data\:image\/\w+\;base64\,/,"");u=new XMLHttpRequest;u.open("POST",t,!0);u.upload&&u.upload.addEventListener&&u.upload.addEventListener("progress",function(n){if(n.lengthComputable){var t=n.loaded/n.total;i.dispatch("uploadProgress",t,n)}},!1);h=this;u.onload=function(){r&&r.apply(h,[u.status,u.responseText,u.statusText]);i.dispatch("uploadComplete",u.status,u.responseText,u.statusText)};c=new Blob([this.base64DecToArr(s)],{type:"image/"+f});e=new FormData;e.append(o,c,o+"."+f.replace(/e/,""));u.send(e)}};i.init();typeof define=="function"&&define.amd?define(function(){return i}):typeof module=="object"&&module.exports?module.exports=i:n.Webcam=i})(window);
//# sourceMappingURL=webcam.min.js.map
